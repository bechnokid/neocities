"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}!function(){class e{constructor(e,t=""){_defineProperty(this,"_id",""),_defineProperty(this,"_name",""),this._id=e,this._name=t}getId(){return this._id}getName(){return this._name}static initializeFromDataArray(t){let i=[];return t.forEach((t=>{i.push(new e(t.id,t.name))})),i}getDisplayName(){return this._name}}class t{constructor(t,i,s,n){_defineProperty(this,"_playerId",""),_defineProperty(this,"_elementId",""),_defineProperty(this,"_youtubeApi",null),_defineProperty(this,"_songs",[]),_defineProperty(this,"_youtubePlayerParams",{}),_defineProperty(this,"_currentSongIndex",0),_defineProperty(this,"_currentSongLength",0),_defineProperty(this,"_volume",100),_defineProperty(this,"_isSeekerUsed",!1),_defineProperty(this,"_layout",{}),this._elementId=n,this._playerId=s,this._youtubeApi=i,t.forEach((t=>{t instanceof e&&this._songs.push(t)})),setInterval(this._updateSeekers.bind(this),100),this._setupLayout(),this.updateLayout()}setYoutubeApi(e){this._youtubeApi=e}_getIdPostfix(){return""===this._playerId?"":`-${this._playerId}`}_getElementRole(e){let t=this._getIdPostfix();return""===t?e:e+t}_getAllElementsByRole(e,t=document){return t.querySelectorAll(`[data-yt-role='${this._getElementRole(e)}']`)}_getElementByRole(e,t=document){return t.querySelector(`[data-yt-role='${this._getElementRole(e)}']`)}_setupLayout(){let e=document.createElement("div");e.id=this._elementId,document.body.appendChild(e),this._layout.youtubeIframe=e;let t=this._getAllElementsByRole("playback");t.forEach((e=>{e.addEventListener("click",(()=>{1===this._youtubeApi.getPlayerState()?this.pause():this.play()}))})),this._layout.playbackButtons=t;let i=this._getAllElementsByRole("next");i.forEach((e=>{e.addEventListener("click",(()=>{this.nextTrack()}))})),this._layout.nextButtons=i;let s=this._getAllElementsByRole("prev");s.forEach((e=>{e.addEventListener("click",(()=>{this.previousTrack()}))})),this._layout.prevButtons=s;let n=this._getAllElementsByRole("song-name-display");this._layout.songNameDisplays=n;let o=this._getAllElementsByRole("song-list");this._layout.songListContainers=o;let r=this._getElementByRole("song-list-entry");if(r){let e=r.cloneNode(!0);r.remove(),this._songs.forEach(((t,i)=>{let s=e.cloneNode(!0),n=this._getElementByRole("song-list-entry-text",s);n&&(n.innerText=t.getDisplayName());let o=this._getElementByRole("song-list-entry-number",s);o&&(o.innerText=`${i+1}`),s.onclick=e=>{this.loadSong(i)},s.dataset.songId=t.getId(),this._layout.songListContainers.forEach((e=>{e.appendChild(s)}))}))}let a=this._getAllElementsByRole("song-seeker");this._layout.songSeekers=a,this._layout.songSeekers.forEach((e=>{e.value=0,e.onchange=e=>{0!==this._currentSongLength?(this.seekTo(e.target.value),this._layout.songSeekers.forEach((t=>{t.value=e.target.value}))):e.target.value=0},e.oninput=e=>{if(this._isSeekerUsed=!0,0===this._currentSongLength)return void(e.target.value=0);this._layout.songSeekers.forEach((t=>{t.value=e.target.value}));let t=Math.floor(e.target.value/60),i=e.target.value-60*t;i=Math.floor(i).toString().padStart(2,0),this._layout.songCurrentTimeDisplays.forEach((e=>{e.innerText=`${t}:${i}`}))},e.onmouseup=e=>{this._isSeekerUsed=!1}}));let l=this._getAllElementsByRole("volume-bar");this._layout.volumeBars=l,this._layout.volumeBars.forEach((e=>{e.value=100,e.onchange=e=>{this.setVolume(e.target.value),this._layout.volumeBars.forEach((t=>{t.value=e.target.value}))},e.oninput=e=>{this.setVolume(e.target.value),this._layout.volumeBars.forEach((t=>{t.value=e.target.value}))}}));let u=this._getAllElementsByRole("song-current-time");this._layout.songCurrentTimeDisplays=u,this._layout.songCurrentTimeDisplays.forEach((e=>{e.innerText="0:00"}));let h=this._getAllElementsByRole("song-length");this._layout.songLengthDisplays=h,this._layout.songLengthDisplays.forEach((e=>{e.innerText="0:00"}))}_resetSeekers(){this._layout.songCurrentTimeDisplays.forEach((e=>{e.innerText="0:00"})),this._layout.songSeekers.forEach((e=>{e.value=0}))}_getSongLengthParts(){let e=this._currentSongLength,t=Math.floor(e/60),i=e-60*t;return i=i.toString().padStart(2,0),{minutes:t,seconds:i}}_updateSeekers(){if(!this._youtubeApi||!this._youtubeApi.getCurrentTime||this._isSeekerUsed)return;let e=this._youtubeApi.getCurrentTime();this._layout.songSeekers.forEach((t=>{t.value=e}));let t=Math.floor(e/60),i=e-60*t;i=Math.floor(i).toString().padStart(2,0),this._layout.songCurrentTimeDisplays.forEach((e=>{e.innerText=`${t}:${i}`}))}onStateChange(e){1==e.data&&this._setSongLengthForSeekers(),0==e.data&&this.nextTrack()}_setSongLengthForSeekers(){let e,t,i=this._youtubeApi.getDuration();this._currentSongLength=Math.ceil(i),[e,t]=[this._getSongLengthParts().minutes,this._getSongLengthParts().seconds],this._layout.songLengthDisplays.forEach((i=>{i.innerText=`${e}:${t}`})),this._layout.songSeekers.forEach((e=>{e.max=this._currentSongLength}))}play(){this._youtubeApi.playVideo(),this._resetSeekers()}pause(){this._youtubeApi.pauseVideo()}loadSong(e){e>=this._songs.length||e<0||(this._currentSongIndex=e,this._youtubeApi.loadVideoById(this.getCurrentSong().getId()),this.setVolume(this._volume),this.updateLayout(),this._resetSeekers())}seekTo(e){this._youtubeApi&&this._youtubeApi.seekTo&&this._youtubeApi.seekTo(e,!0)}setVolume(e){this._volume=e,this._youtubeApi&&this._youtubeApi.setVolume&&this._youtubeApi.setVolume(this._volume)}updateLayout(){let e=this.getCurrentSong().getName();this._layout.songNameDisplays.forEach((t=>{t.innerText=e})),this._layout.songListContainers.forEach((e=>{this._getAllElementsByRole("song-list-entry",e).forEach((e=>{e.dataset.songId===this.getCurrentSong().getId()?e.dataset["currentSong"+this.getPlayerId()]="":delete e.dataset["currentSong"+this.getPlayerId()]}))}))}cueSong(e){e>=this._songs.length||e<0||(this._currentSongIndex=e,this._youtubeApi.cueVideoById(this.getCurrentSong().getId()),this.updateLayout())}nextTrack(){this._currentSongIndex+1>=this._songs.length||this.loadSong(this._currentSongIndex+1)}previousTrack(){this._currentSongIndex-1<0||this.loadSong(this._currentSongIndex-1)}getCurrentSong(){return this._songs[this._currentSongIndex]}getElementId(){return this._elementId}getPlayerId(){return this._playerId}getSongs(){return this._songs}}class i{constructor(){if(_defineProperty(this,"_waitForYoutubeApiIntervalId",null),_defineProperty(this,"_waitingPlayersPool",[]),_defineProperty(this,"_instance",null),_defineProperty(this,"_playerStorage",{}),!i._initialized)throw new Error("please don't call the constructor by yourself (´。＿。｀)");this._initializeYoutubeApi()}_initializeYoutubeApi(){let e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}static getInstance(){return this._instance||(i._initialized=!0,this._instance=new i),this._instance}createPlayer(s,n="",o=""){if(this._playerStorage[n])throw new Error(`A Player with an id of '${n}' already exists!`);if(!Array.isArray(s)||0===s.length)throw new Error("initialSongs is empty or is not an Array!");s.forEach((t=>{if(!(t instanceof e))throw new Error("initialSongs contains invalid objects!")}));let r=new t(s,null,n,this._getPlayerElementId(o,n)),a={height:"0",width:"0",videoId:s[0].getId(),events:{onStateChange:r.onStateChange.bind(r)}};if(i._youtubeApiReady){let e=new YT.Player(this._getPlayerElementId(o,n),a);r.setYoutubeApi(e)}else this._waitForYoutubeApiIntervalId||(this._waitForYoutubeApiIntervalId=setInterval((l=this,function(){i._youtubeApiReady&&(clearInterval(l._waitForYoutubeApiIntervalId),l._setYoutubeApiForWaitingPoolPlayers())}),100));var l;i._youtubeApiReady||this._waitingPlayersPool.push(r),this._playerStorage[n]=r}_setYoutubeApiForWaitingPoolPlayers(){this._waitingPlayersPool.forEach((e=>{let t={height:"0",width:"0",videoId:e.getSongs()[0].getId(),events:{onStateChange:e.onStateChange.bind(e)}},i=new YT.Player(this._getPlayerElementId(e.getElementId(),e.getPlayerId()),t);e.setYoutubeApi(i)}))}_getPlayerElementId(e,t){if(""!==e)return e;let i="yt-player";return t&&(i=`${i}-${t}`),i}onYouTubeIframeAPIReady(){i._youtubeApiReady=!0}}_defineProperty(i,"_initialized",!1),_defineProperty(i,"_youtubeApiReady",!1),window.onYouTubeIframeAPIReady=function(){i.getInstance().onYouTubeIframeAPIReady()},window.PlayerManager=i,window.Song=e}();